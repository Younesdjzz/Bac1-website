{% extends "base.html" %}

{% block titre %}
    <h1>Émissions de CO₂ liées aux vols des aéroports belges</h1>
{% endblock %}

{% block content_up %}
    <!-- Contenu avant la section principale (s'il y en a besoin) -->
{% endblock %}

{% block content %}
    <!-- ========================== PARTIE 1 - Tous les aéroports belges ========================== -->
    {% if data %}
    <div class="section">
        <h2>Émissions totales des 5 aéroports belges</h2>

        {% set total_be = namespace(val=0) %}
        {% for e in data["emissions"] %}
            {% set total_be.val = total_be.val + e %}
        {% endfor %}

        <p><strong>Total cumulé :</strong> {{ total_be.val | round(2) }} tonnes de CO₂</p>

        <table>
            <thead>
                <tr>
                    <th>Aéroport</th>
                    <th>Émissions (tonnes CO₂)</th>
                    <th>Part relative (%)</th>
                </tr>
            </thead>
            <tbody>
                {% for i in range(data["aeroports"]|length) %}
                <tr>
                    <td>{{ data["aeroports"][i] }}</td>
                    <td>{{ data["emissions"][i] | round(2) }}</td>
                    <td>{{ (data["emissions"][i] / total_be.val * 100) | round(1) }}%</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <p><strong>Comparaison :</strong> Cela représente environ {{ (total_be.val / 16000000 * 100) | round(2) }}% des émissions annuelles de la Wallonie (~16 Mt CO₂).</p>
    </div>
    {% endif %}


    
    <!-- ========================== PARTIE 2 - Formulaire et résultats filtrés ========================== -->
    <div class="section">
        <h2>Émissions d’un aéroport pour une période donnée</h2>
        <form method="get" action="{{ url_for('graph.requete_emission') }}">
            <label for="dep">Aéroport de départ :</label>
            <input list="airports" name="dep" id="dep" placeholder="Tapez le nom de l'aéroport" autocomplete="off" required>
            
            <!-- Datalist pour l'autocomplétion des aéroports -->
            <datalist id="airports">
                {% for airport in airports %}
                    <option value="{{ airport.name }}">  <!-- airport.name est le nom de l'aéroport -->
                {% endfor %}
            </datalist>

            <label for="date_deb">Date de début :</label>
            <input type="date" name="date_deb" value="{{ request.args.get('date_deb', '') }}" required>

            <label for="date_fin">Date de fin :</label>
            <input type="date" name="date_fin" value="{{ request.args.get('date_fin', '') }}" required>

            <button type="submit">Afficher</button>
        </form>
    </div>

    {% if datas %}
    <div class="section">
        <h3>Émissions par pays pour l’aéroport sélectionné</h3>

        {% set total_filtered = namespace(val=0) %}
        {% for v in datas.values() %}
            {% set total_filtered.val = total_filtered.val + v[0] %}
        {% endfor %}

        <p><strong>Émissions totales :</strong> {{ total_filtered.val | round(2) }} tonnes de CO₂</p>

        <table>
            <thead>
                <tr>
                    <th>Pays de destination</th>
                    <th>Émissions (tonnes CO₂)</th>
                    <th>Part (%)</th>
                </tr>
            </thead>
            <tbody>
                {% for country, val in datas.items() %}
                <tr>
                    <td>{{ country }}</td>
                    <td>{{ val[0] | round(2) }}</td>  <!-- val[0] est le CO₂ -->
                    <td>{{ val[1] | round(1) }}%</td>  <!-- val[1] est le pourcentage -->
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% endif %}
{% endblock %}

{% block content_down %}
    <!-- Contenu sous la section principale (si nécessaire) -->
{% endblock %}
